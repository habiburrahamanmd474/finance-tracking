<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <title>‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßã‡¶®‡¶æ‡¶≤ ‡¶´‡¶æ‡¶á‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶∏ ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶∞</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Firebase & Chart.js -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    body { font-family: 'Noto Sans Bengali', sans-serif; max-width: 1100px; margin: auto; background: #f5f5f5; padding: 12px;}
    h2 {text-align:center; margin:18px 0 5px 0;}
    .tab-nav { display:flex; gap:10px; margin:22px 0 15px 0; justify-content:center;}
    .tab-nav button { background:#ecebff; border:none; border-radius:8px; padding:10px 28px; font-size:1.08em; color:#6c63ff; font-weight:600; cursor:pointer; transition:.18s;}
    .tab-nav button.active, .tab-nav button:hover { background:#6c63ff; color:#fff;}
    #financeTab, #adminTab, #settingsTab { display:none; }
    #financeTab.active, #adminTab.active, #settingsTab.active { display:block; }
    .success { color: #23b46d;}
    #userStatus { color: #e43b44; min-height: 24px;}
    .summary { margin: 16px 0 12px 0; background: #c8e6c9; padding: 10px;}
    #loginSection input, #loginSection button { margin: 5px; padding: 6px; }
    #loginSection { background: #e3f2fd; padding: 13px; margin-bottom: 11px; border-radius:9px;}
    #appSection { display: none; }
    #emailError { color: red; display: none; margin-left: 5px; }
    .finance-table-tools { margin: 10px 0 9px 0; display: flex; gap: 13px; flex-wrap: wrap; align-items: center;}
    .finance-table-section { overflow-x: auto;}
    #financeBody tr.editing td { background: #f7efd3 !important;}
    #financeBody td .edit-btn, #financeBody td .save-btn, #financeBody td .cancel-btn {
      font-size: .97em; padding: 4px 9px; margin:2px; border-radius:5px; border:none; cursor:pointer;
    }
    #financeBody td .edit-btn { background: #ecebff; color: #6c63ff; }
    #financeBody td .edit-btn:hover { background: #c8e6c9; color: #1ab048;}
    #financeBody td .save-btn { background: #23c483; color: #fff;}
    #financeBody td .cancel-btn { background: #ff6584; color: #fff;}
    #financeBody td input, #financeBody td select {
      width: 80px; font-size:.95em; padding:3px 7px; border-radius:4px; border:1px solid #bbb;
    }
    .no-data { color: #888; text-align: center; padding: 18px; font-size: 1.07em;}
    .pagination { text-align:center; margin:7px 0;}
    .pgn-btn { background:#ecebff; color:#6c63ff; border:none; border-radius:7px; padding:6px 13px; font-size:1.07em; margin:0 2px; cursor:pointer;}
    .pgn-btn.active, .pgn-btn:hover { background:#6c63ff; color:#fff;}
    .admin-panel-title { font-size: 1.2em; font-weight: 700; color: #6c63ff; border-left: 4px solid #6c63ff; padding-left: 11px;}
    .user-table-section { overflow-x: auto;}
    .user-table-section table { width: 100%; border-collapse: separate; border-spacing: 0; font-size: 1.07em; min-width: 700px; background: #fff;}
    .user-table-section th, .user-table-section td { padding: 8px 8px; border-bottom: 1px solid #e1e4ea;}
    .status-badge.active { background: #e9fff4; color: #23c483; padding:2px 10px; border-radius:7px;}
    .status-badge.inactive { background: #ffeaea; color: #ff6584; padding:2px 10px; border-radius:7px;}
    .edit-btn, .delete-btn, .showpass-btn, .reset-btn, .status-btn { background: #ecebff; color: #6c63ff; border: none; border-radius: 8px; padding: 4px 9px; font-size: 1.03em; cursor: pointer; margin:1px;}
    .delete-btn { background: #ffeaea; color: #ff6584;}
    .delete-btn:hover { background: #ff6584; color: #fff;}
    .notif-bar { display:none; position:fixed; top:18px; left:50%; transform:translateX(-50%); z-index:9999; padding:10px 38px; border-radius:8px; font-size:1.06em; font-weight:600;}
    .notif-bar.success { background:#e9fff4; color:#23c483;}
    .notif-bar.error { background:#ffeaea; color:#ff6584;}
    .dark { background: #1a1a2f; color: #f3f3f3;}
    .dark .summary, .dark #loginSection, .dark .finance-table-section table, .dark .user-table-section table { background: #232334 !important; color:#f3f3f3;}
    .dark .tab-nav button { background:#232334; color: #ffd86e;}
    .dark .tab-nav button.active, .dark .tab-nav button:hover { background:#ffd86e; color:#232334;}
    .theme-btn { position:fixed; bottom:20px; right:20px; background:#ecebff; color:#6c63ff; border:none; border-radius:50%; font-size:1.5em; padding:13px; cursor:pointer; box-shadow:0 2px 15px #0002;}
    .theme-btn.active { background:#232334; color:#ffd86e;}
    @media (max-width: 700px) {
      body {padding:7px;}
      #financeBody td input, #financeBody td select {width:60px;}
      .user-table-section table { min-width:420px;}
    }
  </style>
</head>
<body>
<h2>‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßã‡¶®‡¶æ‡¶≤ ‡¶´‡¶æ‡¶á‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶∏ ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶∞</h2>
<div class="tab-nav">
  <button id="tabFinance" class="active" onclick="showTab('finance')"><i class="fa-solid fa-wallet"></i> ‡¶´‡¶æ‡¶á‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶∏</button>
  <button id="tabAdminPanel" style="display:none;" onclick="showTab('admin')"><i class="fa-solid fa-users-gear"></i> ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®</button>
  <button id="tabSettings" onclick="showTab('settings')"><i class="fa-solid fa-gear"></i> ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</button>
</div>
<!-- ==== Finance Tab ==== -->
<div id="financeTab" class="active">
  <div id="userStatus"></div>
  <div id="loginSection">
    <h3>üîê ‡¶≤‡¶ó‡¶á‡¶® / ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞</h3>
    <input type="email" id="signupEmail" required placeholder="‡¶®‡¶§‡ßÅ‡¶® ‡¶á‡¶Æ‡ßá‡¶á‡¶≤">
    <small id="emailError"></small>
    <input type="password" id="signupPassword" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°">
    <button id="signupBtn">‡¶∏‡¶æ‡¶á‡¶® ‡¶Ü‡¶™</button><br>
    <input type="email" id="loginEmail" required placeholder="‡¶á‡¶Æ‡ßá‡¶á‡¶≤">
    <input type="password" id="loginPassword" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°">
    <button id="loginBtn">‡¶≤‡¶ó‡¶á‡¶®</button>
    <button id="googleLoginBtn" style="background:#eee; color:#dd4b39; border-radius:7px; border:none; font-weight:600; margin-left:7px;"><i class="fa-brands fa-google"></i> ‡¶ó‡ßÅ‡¶ó‡¶≤ ‡¶≤‡¶ó‡¶á‡¶®</button>
    <br>
    <input type="email" id="recoveryEmail" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶∞‡¶ø‡¶ï‡¶≠‡¶æ‡¶∞‡¶ø ‡¶á‡¶Æ‡ßá‡¶á‡¶≤">
    <button id="recoverBtn">‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü</button><br>
    <input type="text" id="adminPin" placeholder="Admin PIN">
    <button id="adminLoginBtn">üéØ Admin Login</button>
  </div>
  <div id="appSection" style="display:none;">
    <div>
      <span id="multiLangWrap" style="float:right;">
        <select id="langSelect" style="padding:2px 9px;">
          <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
          <option value="en">English</option>
        </select>
      </span>
      <p>üë§ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞: <span id="loggedUser"></span> <button id="logoutBtn">‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button></p>
    </div>
    <div class="summary">
      <strong>Income:</strong> ‡ß≥<span id="totalIncome">0</span> |
      <strong>Expenses:</strong> ‡ß≥<span id="totalExpenses">0</span> |
      <strong>Savings:</strong> ‡ß≥<span id="savings">0</span>
    </div>
    <div style="margin-bottom:14px;">
      <h4>‡¶®‡¶§‡ßÅ‡¶® ‡¶§‡¶•‡ßç‡¶Ø ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®:</h4>
      <input type="date" id="dateInput">
      <input type="text" id="descInput" placeholder="‡¶¨‡¶ø‡¶¨‡¶∞‡¶£">
      <input type="number" id="amtInput" placeholder="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£">
      <select id="typeInput">
        <option>Income</option>
        <option>Expense</option>
      </select>
      <select id="accountInput">
        <option value="main">‡¶Æ‡ßÇ‡¶≤ ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü</option>
        <option value="bkash">‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂</option>
        <option value="nagad">‡¶®‡¶ó‡¶¶</option>
        <option value="bank">Bank</option>
      </select>
      <select id="categoryInput"></select>
      <select id="subCatInput"></select>
      <input type="text" id="customCatInput" placeholder="Custom ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø" style="display:none;">
      <textarea id="noteInput" placeholder="‡¶®‡ßã‡¶ü/‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®"></textarea>
      <label><input type="checkbox" id="recurringInput"> Recurring (repeat)</label>
      <button id="addDataBtn">‚ûï ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
<button id="downloadPdfBtn">‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° PDF</button>
  <table id="financeTable">
    <thead>
      <tr>
        <th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
        <th>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</th>
        <th>‡¶ü‡¶æ‡¶á‡¶™</th>
        <th>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (‡ß≥)</th>
      </tr>
    </thead>
    <tbody>
      <button id="exportBtn">‚¨áÔ∏è ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° CSV</button>
    </div>
    <div class="finance-table-tools">
      <input type="text" id="entrySearch" placeholder="‡¶ü‡ßá‡¶¨‡¶ø‡¶≤ ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶ï‡¶∞‡ßÅ‡¶®..." style="padding:5px 11px;">
      <select id="sortSelect">
        <option value="">Sort By</option>
        <option value="date-desc">Date ‚¨áÔ∏è</option>
        <option value="date-asc">Date ‚¨ÜÔ∏è</option>
        <option value="amount-desc">Amount ‚¨áÔ∏è</option>
        <option value="amount-asc">Amount ‚¨ÜÔ∏è</option>
        <option value="income">Only Income</option>
        <option value="expense">Only Expense</option>
      </select>
      <select id="rangeSelect">
        <option value="all">‡¶∏‡¶¨ ‡¶∏‡¶Æ‡ßü</option>
        <option value="today">‡¶Ü‡¶ú</option>
        <option value="week">‡¶è‡¶á ‡¶∏‡¶™‡ßç‡¶§‡¶æ‡¶π</option>
        <option value="month">‡¶è‡¶á ‡¶Æ‡¶æ‡¶∏</option>
        <option value="custom">Custom</option>
      </select>
      <input type="date" id="customStart" style="display:none;">
      <input type="date" id="customEnd" style="display:none;">
    </div>
    <div class="finance-table-section">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
            <th>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</th>
            <th>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th>
            <th>‡¶ß‡¶∞‡¶®</th>
            <th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü</th>
            <th>‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</th>
            <th>‡¶∏‡¶æ‡¶¨-‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</th>
            <th>‡¶®‡ßã‡¶ü</th>
            <th>Recurring</th>
            <th>‡¶è‡¶ï‡¶∂‡¶®</th>
          </tr>
        </thead>
        <tbody id="financeBody"></tbody>
      </table>
      <div id="financeNoData" class="no-data" style="display:none;">‡¶ï‡ßã‡¶®‡ßã ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶®‡ßá‡¶á</div>
      <div id="financePagination" class="pagination"></div>
    </div>
    <div>
      <canvas id="chartCanvas" height="200"></canvas>
      <canvas id="barCanvas" height="200"></canvas>
    </div>
    <div id="aiSuggest" style="margin:20px 0 0 0; color:#6c63ff; font-weight:500;"></div>
    <div id="calendarWrap" style="margin:20px 0 0 0;"></div>
  </div>
</div>
<!-- ==== Admin Panel Tab ==== -->
<div id="adminTab">
  <div class="admin-panel-title">üåü ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</div>
  <div class="user-table-section">
    <table>
      <thead>
        <tr>
          <th>User ID</th>
          <th>‡¶®‡¶æ‡¶Æ</th>
          <th>‡¶á‡¶Æ‡ßá‡¶á‡¶≤</th>
          <th>‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°</th>
          <th>‡¶∞‡ßã‡¶≤</th>
          <th>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</th>
          <th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th>
        </tr>
      </thead>
      <tbody id="userTable"></tbody>
    </table>
    <div id="noData" class="no-data" style="display:none;">‡¶ï‡ßã‡¶®‡ßã ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶®‡ßá‡¶á</div>
  </div>
  <div class="pagination" id="pagination"></div>
  <div id="notifBar" class="notif-bar"></div>
</div>
<!-- ==== Settings Tab ==== -->
<div id="settingsTab">
  <h3>‚öôÔ∏è ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶ì ‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßã‡¶®‡¶æ‡¶≤‡¶æ‡¶á‡¶ú‡ßá‡¶∂‡¶®</h3>
  <button onclick="toggleTheme()" class="theme-btn" id="themeBtn" title="‡¶•‡¶ø‡¶Æ ‡¶ü‡¶ó‡¶≤"><i class="fa-solid fa-moon"></i></button>
  <br><br>
  <label><input type="checkbox" id="pwaSwitch"> PWA ‡¶Æ‡ßã‡¶° ‡¶ö‡¶æ‡¶≤‡ßÅ</label>
  <br>
  <label><input type="checkbox" id="2faSwitch"> 2FA (Two-Factor Authentication)</label>
  <br>
  <label>Notification:</label>
  <select id="notifPref">
    <option value="all">All</option>
    <option value="error">Only Error</option>
    <option value="none">None</option>
  </select>
  <br>
  <button onclick="resetData()">‡¶°‡ßá‡¶ü‡¶æ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü</button>
</div>
<script>
// ===== Firebase Config =====
const firebaseConfig = {
  apiKey: "AIzaSyDD61n7Cayu0ITjg2jyvc9AwYdH8Xf626E",
  authDomain: "many-management.firebaseapp.com",
  databaseURL: "https://many-management-default-rtdb.firebaseio.com",
  projectId: "many-management",
  storageBucket: "many-management.appspot.com",
  messagingSenderId: "739125487895",
  appId: "1:739125487895:web:72d4e241f758d28562ef52"
};
firebase.initializeApp(firebaseConfig);

// ===== SPA Tab System & Admin PIN =====
function showTab(tab) {
  document.getElementById('financeTab').classList.remove('active');
  document.getElementById('adminTab').classList.remove('active');
  document.getElementById('settingsTab').classList.remove('active');
  document.getElementById('tabFinance').classList.remove('active');
  document.getElementById('tabAdminPanel').classList.remove('active');
  document.getElementById('tabSettings').classList.remove('active');
  if(tab==='finance') {
    document.getElementById('financeTab').classList.add('active');
    document.getElementById('tabFinance').classList.add('active');
  } else if(tab==='admin') {
    if(window.currentUserRole!=="admin") {
      alert("‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®‡¶∞‡¶æ ‡¶è‡¶á ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®!");
      return;
    }
    document.getElementById('adminTab').classList.add('active');
    document.getElementById('tabAdminPanel').classList.add('active');
  } else if(tab==='settings') {
    document.getElementById('settingsTab').classList.add('active');
    document.getElementById('tabSettings').classList.add('active');
  }
}
// ===== Login & Admin Auth =====
window.currentUserRole = null;
firebase.auth().onAuthStateChanged(function(user) {
  if (user) {
    document.getElementById("loginSection").style.display = "none";
    document.getElementById("appSection").style.display = "block";
    document.getElementById("loggedUser").innerText = user.email;
    firebase.database().ref('users/'+user.uid).once('value').then(snap=>{
      const role = snap.val()?.role || "user";
      window.currentUserRole = role;
      if(role==="admin") {
        document.getElementById("tabAdminPanel").style.display = "inline-block";
      } else {
        document.getElementById("tabAdminPanel").style.display = "none";
      }
    });
    loadFinanceData(user.uid);
  } else {
    document.getElementById("loginSection").style.display = "block";
    document.getElementById("appSection").style.display = "none";
    document.getElementById("tabAdminPanel").style.display = "none";
    window.currentUserRole = null;
  }
});
document.getElementById("signupBtn").onclick = function() {
  var email = document.getElementById("signupEmail").value;
  var password = document.getElementById("signupPassword").value;
  firebase.auth().createUserWithEmailAndPassword(email, password)
    .then((userCredential) => {
      firebase.database().ref('users/'+userCredential.user.uid).set({email: email, role: "user"});
      document.getElementById("userStatus").innerText = "‡¶∏‡¶æ‡¶á‡¶® ‡¶Ü‡¶™ ‡¶∏‡¶´‡¶≤! ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§";
      document.getElementById("userStatus").className = "success";
    })
    .catch((error) => {
      document.getElementById("userStatus").innerText = "‡¶∏‡¶æ‡¶á‡¶® ‡¶Ü‡¶™ ‡¶π‡ßü‡¶®‡¶ø: " + error.message;
      document.getElementById("userStatus").className = "";
    });
};
document.getElementById("loginBtn").onclick = function() {
  var email = document.getElementById("loginEmail").value;
  var password = document.getElementById("loginPassword").value;
  firebase.auth().signInWithEmailAndPassword(email, password)
    .then(() => {
      document.getElementById("userStatus").innerText = "‡¶≤‡¶ó‡¶á‡¶® ‡¶∏‡¶´‡¶≤!";
      document.getElementById("userStatus").className = "success";
    })
    .catch((error) => {
      document.getElementById("userStatus").innerText = "‡¶≤‡¶ó‡¶á‡¶® ‡¶π‡ßü‡¶®‡¶ø: " + error.message;
      document.getElementById("userStatus").className = "";
    });
};
document.getElementById("logoutBtn").onclick = function() {
  firebase.auth().signOut();
};
document.getElementById("recoverBtn").onclick = function() {
  var email = document.getElementById("recoveryEmail").value;
  if(!email) return alert("‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¶‡¶ø‡¶®!");
  firebase.auth().sendPasswordResetEmail(email)
    .then(() => { alert("Password reset link sent!"); })
    .catch((error) => { alert("Error: " + error.message); });
};
// ==== Google Login ====
document.getElementById("googleLoginBtn").onclick = function() {
  var provider = new firebase.auth.GoogleAuthProvider();
  firebase.auth().signInWithPopup(provider)
    .then(res => {
      document.getElementById("userStatus").innerText = "Google ‡¶≤‡¶ó‡¶á‡¶® ‡¶∏‡¶´‡¶≤!";
      document.getElementById("userStatus").className = "success";
      // ‡¶®‡¶§‡ßÅ‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶π‡¶≤‡ßá ‡¶∞‡ßã‡¶≤ ‡¶∏‡ßá‡¶ü
      firebase.database().ref('users/'+res.user.uid).once('value').then(snap=>{
        if(!snap.val()) firebase.database().ref('users/'+res.user.uid).set({email: res.user.email, role: "user"});
      });
    })
    .catch(err => alert(err.message));
};
// ==== Admin PIN Auth (demo, PIN: 11232347@Habib) ====
document.getElementById("adminLoginBtn").onclick = function() {
  const pin = document.getElementById("adminPin").value;
  if(pin==="11232347@Habib") {
    window.currentUserRole = "admin";
    document.getElementById("tabAdminPanel").style.display = "inline-block";
    showTab("admin");
    document.getElementById("adminPin").value="";
  } else {
    alert("‡¶≠‡ßÅ‡¶≤ PIN!");
  }
};
// ===== Email Validation =====
const signupEmail = document.getElementById("signupEmail");
const loginEmail = document.getElementById("loginEmail");
const emailError = document.getElementById("emailError");
function validateEmailFormat(email) {
  const pattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return pattern.test(email);
}
function showValidation(emailInput) {
  emailInput.addEventListener("input", () => {
    if (!validateEmailFormat(emailInput.value)) {
      emailError.textContent = "‚ö†Ô∏è ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü ‡¶∏‡¶†‡¶ø‡¶ï ‡¶®‡ßü!";
      emailError.style.display = "block";
    } else {
      emailError.textContent = "";
      emailError.style.display = "none";
    }
  });
}
showValidation(signupEmail);
showValidation(loginEmail);

// ===== Dark Mode =====
function toggleTheme() {
  document.body.classList.toggle("dark");
  document.getElementById("themeBtn").classList.toggle("active");
  localStorage.setItem("theme", document.body.classList.contains("dark")?"dark":"light");
}
if(localStorage.getItem("theme")==="dark") {
  document.body.classList.add("dark");
  document.getElementById("themeBtn").classList.add("active");
}

// ===== Multi-language (‡¶°‡ßá‡¶Æ‡ßã) =====
document.getElementById('langSelect').onchange = function() {
  if(this.value==="en") alert("Demo: English language mode!");
  else alert("Demo: ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶Æ‡ßã‡¶°!");
};
// ===== Finance Data (Advanced Table) =====
let financeRawArr = [];
let financeArr = [];
let financeCurrentPage = 1, financeRowsPerPage = 7;
let financeSortType = "";
let financeSearchText = "";
let financeRangeType = "all";
let customRangeStart = "", customRangeEnd = "";
function loadFinanceData(uid) {
  firebase.database().ref('finance/'+uid+'/data').on('value', snap=>{
    const arr = snap.val() ? Object.entries(snap.val()).map(([k,v])=>({...v,_key:k})) : [];
    financeRawArr = arr;
    updateFinanceTable();
    renderSummary(arr);
    renderChart(arr);
    renderBarChart(arr);
    aiSuggestion(arr);
    renderCalendar(arr);
  });
}
function updateFinanceTable() {
  let arr = financeRawArr.slice();
  // Time Range Filter
  if(financeRangeType!=="all") {
    let today = new Date(), st, en;
    if(financeRangeType==="today") {
      let d = today.toISOString().slice(0,10);
      arr = arr.filter(x=>x.date===d);
    } else if(financeRangeType==="week") {
      st = new Date(today); st.setDate(st.getDate()-today.getDay());
      en = new Date(today); en.setDate(en.getDate()+(6-today.getDay()));
      arr = arr.filter(x=>{
        let dx=new Date(x.date);
        return dx>=st && dx<=en;
      });
    } else if(financeRangeType==="month") {
      let ym = today.toISOString().slice(0,7);
      arr = arr.filter(x=>(x.date||"").startsWith(ym));
    } else if(financeRangeType==="custom") {
      if(customRangeStart && customRangeEnd)
        arr = arr.filter(x=>x.date>=customRangeStart && x.date<=customRangeEnd);
    }
  }
  // Search
  if(financeSearchText && financeSearchText.length>1) {
    arr = arr.filter(d =>
      (d.desc||"").toLowerCase().includes(financeSearchText) ||
      (d.category||"").toLowerCase().includes(financeSearchText)
    );
  }
  // Sort
  if(financeSortType==="date-asc") arr.sort((a,b)=>a.date.localeCompare(b.date));
  else if(financeSortType==="date-desc") arr.sort((a,b)=>b.date.localeCompare(a.date));
  else if(financeSortType==="amount-asc") arr.sort((a,b)=>+a.amount - +b.amount);
  else if(financeSortType==="amount-desc") arr.sort((a,b)=>+b.amount - +a.amount);
  else if(financeSortType==="income") arr = arr.filter(d=>d.type==="Income");
  else if(financeSortType==="expense") arr = arr.filter(d=>d.type==="Expense");
  financeArr = arr;
  financeCurrentPage = Math.max(1, Math.min(financeCurrentPage, Math.ceil(arr.length/financeRowsPerPage)||1));
  renderFinanceTable();
  renderFinancePagination();
}
function renderFinanceTable() {
  let tbody = document.getElementById("financeBody");
  let noData = document.getElementById("financeNoData");
  tbody.innerHTML = "";
  let arr = financeArr;
  if(arr.length===0) { noData.style.display="block"; return; } else { noData.style.display="none"; }
  let start = (financeCurrentPage-1)*financeRowsPerPage;
  let end = Math.min(start+financeRowsPerPage, arr.length);
  for(let idx=start; idx<end; idx++) {
    let d = arr[idx];
    if(d._editing) {
      tbody.innerHTML += `
        <tr class="editing">
          <td>${idx+1}</td>
          <td><input type="date" value="${d.date}"></td>
          <td><input type="text" value="${d.desc}"></td>
          <td><input type="number" value="${d.amount}"></td>
          <td>
            <select>
              <option${d.type==="Income"?" selected":""}>Income</option>
              <option${d.type==="Expense"?" selected":""}>Expense</option>
            </select>
          </td>
          <td>
            <select>
              <option${d.account==="main"?" selected":""}>‡¶Æ‡ßÇ‡¶≤ ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü</option>
              <option${d.account==="bkash"?" selected":""}>‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂</option>
              <option${d.account==="nagad"?" selected":""}>‡¶®‡¶ó‡¶¶</option>
              <option${d.account==="bank"?" selected":""}>Bank</option>
            </select>
          </td>
          <td><input type="text" value="${d.category}"></td>
          <td><input type="text" value="${d.subcat||""}"></td>
          <td><input type="text" value="${d.note||""}"></td>
          <td>
            <input type="checkbox" ${d.recurring?"checked":""}>
          </td>
          <td>
            <button class="save-btn" onclick="saveEditFinance(${idx})">Save</button>
            <button class="cancel-btn" onclick="cancelEditFinance(${idx})">Cancel</button>
          </td>
        </tr>
      `;
    } else {
      tbody.innerHTML += `
        <tr>
          <td>${idx+1}</td>
          <td>${d.date||""}</td>
          <td>${d.desc||""}</td>
          <td>${d.amount||""}</td>
          <td>${d.type||""}</td>
          <td>${d.account||""}</td>
          <td>${d.category||""}</td>
          <td>${d.subcat||""}</td>
          <td>${d.note||""}</td>
          <td>${d.recurring?"‚úîÔ∏è":""}</td>
          <td>
            <button class="edit-btn" onclick="editFinance(${idx})"><i class="fa-solid fa-pen"></i></button>
            <button onclick="deleteEntry(${idx})">‡¶°‡¶ø‡¶≤‡¶ø‡¶ü</button>
          </td>
        </tr>
      `;
    }
  }
}
function renderFinancePagination() {
  let arr = financeArr;
  let pages = Math.ceil(arr.length/financeRowsPerPage);
  let html = '';
  if(pages<=1) { document.getElementById('financePagination').innerHTML=""; return;}
  for(let i=1;i<=pages;i++) {
    html += `<button class="pgn-btn${i===financeCurrentPage?' active':''}" onclick="gotoFinancePage(${i})">${i}</button>`;
  }
  document.getElementById('financePagination').innerHTML = html;
}
window.gotoFinancePage = function(i) { financeCurrentPage=i; renderFinanceTable(); renderFinancePagination(); }
document.getElementById("entrySearch").addEventListener("input", function(e){
  financeSearchText = this.value.toLowerCase().trim();
  financeCurrentPage = 1;
  updateFinanceTable();
});
document.getElementById("sortSelect").addEventListener("change", function(e){
  financeSortType = this.value;
  financeCurrentPage = 1;
  updateFinanceTable();
});
document.getElementById("rangeSelect").addEventListener("change", function(e){
  financeRangeType = this.value;
  document.getElementById("customStart").style.display = financeRangeType==="custom"?"inline-block":"none";
  document.getElementById("customEnd").style.display = financeRangeType==="custom"?"inline-block":"none";
  updateFinanceTable();
});
document.getElementById("customStart").addEventListener("change", function(e){
  customRangeStart = this.value;
  updateFinanceTable();
});
document.getElementById("customEnd").addEventListener("change", function(e){
  customRangeEnd = this.value;
  updateFinanceTable();
});
document.getElementById("addDataBtn").onclick = function() {
  var date = document.getElementById("dateInput").value;
  var desc = document.getElementById("descInput").value;
  var amount = document.getElementById("amtInput").value;
  var type = document.getElementById("typeInput").value;
  var account = document.getElementById("accountInput").value;
  var category = document.getElementById("categoryInput").value;
  var subcat = document.getElementById("subCatInput").value;
  var note = document.getElementById("noteInput").value;
  var recurring = document.getElementById("recurringInput").checked;
  var user = firebase.auth().currentUser;
  if(!date || !desc || !amount || !category) return alert("‡¶∏‡¶¨ ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®!");
  var entry = {date, desc, amount, type, account, category, subcat, note, recurring};
  firebase.database().ref('finance/'+user.uid+'/data').push(entry);
  document.getElementById("dateInput").value="";
  document.getElementById("descInput").value="";
  document.getElementById("amtInput").value="";
  document.getElementById("categoryInput").value="";
  document.getElementById("subCatInput").value="";
  document.getElementById("noteInput").value="";
  document.getElementById("recurringInput").checked=false;
};
window.deleteEntry = function(idx) {
  var user = firebase.auth().currentUser;
  if(!user) return;
  let arr = financeArr;
  let _key = arr[idx]._key;
  firebase.database().ref('finance/'+user.uid+'/data/'+_key).remove();
};
window.editFinance = function(idx) {
  financeArr[idx]._editing = true;
  renderFinanceTable();
}
window.cancelEditFinance = function(idx) {
  financeArr[idx]._editing = false;
  renderFinanceTable();
}
window.saveEditFinance = function(idx) {
  let tr = document.getElementById("financeBody").children[idx];
  let date = tr.children[1].children[0].value;
  let desc = tr.children[2].children[0].value;
  let amount = tr.children[3].children[0].value;
  let type = tr.children[4].children[0].value;
  let account = tr.children[5].children[0].value;
  let category = tr.children[6].children[0].value;
  let subcat = tr.children[7].children[0].value;
  let note = tr.children[8].children[0].value;
  let recurring = tr.children[9].children[0].checked;
  if(!date || !desc || !amount || !category) return alert("‡¶∏‡¶¨ ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®!");
  let user = firebase.auth().currentUser;
  let _key = financeArr[idx]._key;
  let entry = {date, desc, amount, type, account, category, subcat, note, recurring};
  firebase.database().ref('finance/'+user.uid+'/data/'+_key).set(entry);
  financeArr[idx]._editing = false;
  renderFinanceTable();
}
document.getElementById("exportBtn").onclick = function() {
  let arr = financeArr;
  let csv = "Date,Description,Amount,Type,Account,Category,Subcategory,Note,Recurring\n";
  arr.forEach(d=>{
    csv += `${d.date},${d.desc},${d.amount},${d.type},${d.account},${d.category},${d.subcat||""},${d.note||""},${d.recurring?"yes":"no"}\n`;
  });
  let blob = new Blob([csv],{type:"text/csv"});
  let link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "finance.csv";
  link.click();
};
function renderSummary(arr) {
  let income = 0, exp = 0;
  arr.forEach(d=>{
    if(d.type==="Income") income += +d.amount;
    else exp += +d.amount;
  });
  document.getElementById("totalIncome").innerText = income;
  document.getElementById("totalExpenses").innerText = exp;
  document.getElementById("savings").innerText = income-exp;
}
function renderChart(arr) {
  if(window.chartObj) window.chartObj.destroy();
  let income = 0, exp = 0;
  arr.forEach(d=>{ if(d.type==="Income") income+=+d.amount; else exp+=+d.amount; });
  var ctx = document.getElementById('chartCanvas').getContext('2d');
  window.chartObj = new Chart(ctx, {
    type:'pie',
    data: {
      labels: ["Income","Expense"],
      datasets: [{
        data: [income,exp],
        backgroundColor: ["#6c63ff","#ff6584"],
      }]
    },
    options: {responsive:true}
  });
}
function renderBarChart(arr) {
  if(window.barChartObj) window.barChartObj.destroy();
  let cats = {};
  arr.forEach(d=>{
    let c = d.category||"‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø";
    cats[c] = (cats[c]||0)+(+d.amount||0);
  });
  var ctx = document.getElementById('barCanvas').getContext('2d');
  window.barChartObj = new Chart(ctx, {
    type:'bar',
    data: {
      labels: Object.keys(cats),
      datasets: [{
        label: "Amount",
        data: Object.values(cats),
        backgroundColor: "#6c63ffb8"
      }]
    },
    options: {responsive:true}
  });
}
// ==== Time-based AI Suggestion (Demo) ====
function aiSuggestion(arr) {
  if(arr.length<2) return document.getElementById("aiSuggest").innerText="";
  let thisMonth = new Date().toISOString().slice(0,7);
  let prevMonth = new Date(new Date().setMonth(new Date().getMonth()-1)).toISOString().slice(0,7);
  let sum = m => arr.filter(x=>(x.date||"").startsWith(m) && x.type==="Income").reduce((a,b)=>a+(+b.amount||0),0);
  let incomeThis = sum(thisMonth), incomePrev = sum(prevMonth);
  let msg = "";
  if(incomeThis<incomePrev) msg="‚ö†Ô∏è ‡¶è‡¶á ‡¶Æ‡¶æ‡¶∏‡ßá ‡¶Ü‡¶Ø‡¶º ‡¶ï‡¶Æ‡ßá‡¶õ‡ßá ("+(incomeThis-incomePrev)+")";
  else if(incomeThis>incomePrev) msg="ü•≥ ‡¶è‡¶á ‡¶Æ‡¶æ‡¶∏‡ßá ‡¶Ü‡¶Ø‡¶º ‡¶¨‡ßá‡¶°‡¶º‡ßá‡¶õ‡ßá!";
  else msg="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶Ø‡¶º ‡¶Ö‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§‡•§";
  let saving = arr.filter(x=>(x.date||"").startsWith(thisMonth)&&x.type==="Income").reduce((a,b)=>a+parseFloat(b.amount||0),0)
              - arr.filter(x=>(x.date||"").startsWith(thisMonth)&&x.type==="Expense").reduce((a,b)=>a+parseFloat(b.amount||0),0);
  if(saving>0) msg += " üëç ‡¶∏‡¶û‡ßç‡¶ö‡¶Ø‡¶º ‡¶π‡¶ö‡ßç‡¶õ‡ßá!";
  else msg += " ‚ö†Ô∏è ‡¶ñ‡¶∞‡¶ö ‡¶∏‡¶æ‡¶Æ‡¶≤‡¶æ‡¶®‡•§";
  document.getElementById("aiSuggest").innerText=msg;
}
// ==== Calendar View (Demo) ====
function renderCalendar(arr) {
  // Simple: show date-wise amount (not a full calendar lib)
  let html = "<b>üìÖ ‡¶¶‡¶ø‡¶®‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶ï ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø:</b><br>";
  let byDate = {};
  arr.forEach(d=>{ byDate[d.date]=byDate[d.date]||[]; byDate[d.date].push(d); });
  Object.keys(byDate).sort().forEach(date=>{
    let total = byDate[date].reduce((s,x)=>s+(+x.amount||0),0);
    html += `<span style="display:inline-block;min-width:115px">${date}</span> : <b>${total}</b> (${byDate[date].length} ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø)<br>`;
  });
  document.getElementById("calendarWrap").innerHTML = html;
}
// ==== Category/Subcategory Dropdown (Demo) ====
let categories = {
  "‡¶ñ‡¶æ‡¶¶‡ßç‡¶Ø": ["‡¶∞‡ßá‡¶∏‡ßç‡¶ü‡ßÅ‡¶∞‡ßá‡¶®‡ßç‡¶ü","‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡ßá‡¶ü","‡¶ö‡¶æ/‡¶ï‡¶´‡¶ø"],
  "‡¶™‡¶∞‡¶ø‡¶¨‡¶π‡¶®": ["‡¶¨‡¶æ‡¶∏","‡¶∞‡¶ø‡¶ï‡¶∂‡¶æ","‡¶â‡¶¨‡¶æ‡¶∞"],
  "‡¶¨‡ßá‡¶§‡¶®": ["‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶¨‡ßá‡¶§‡¶®"],
  "‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ": ["‡¶¨‡¶á","‡¶ü‡¶ø‡¶â‡¶∂‡¶®"],
  "‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø": []
};
function renderCategoryDropdown() {
  let catSel = document.getElementById("categoryInput");
  catSel.innerHTML = `<option value="">‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</option><option value="_custom">‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</option>`;
  Object.keys(categories).forEach(c=>{
    catSel.innerHTML += `<option value="${c}">${c}</option>`;
  });
}
function renderSubCatDropdown() {
  let cat = document.getElementById("categoryInput").value;
  let subSel = document.getElementById("subCatInput");
  if(cat==="_custom") {
    document.getElementById("customCatInput").style.display="inline-block";
    subSel.innerHTML = "";
    subSel.style.display="none";
  } else if(cat && categories[cat]) {
    document.getElementById("customCatInput").style.display="none";
    let subs = categories[cat];
    subSel.innerHTML = `<option value="">‡¶∏‡¶æ‡¶¨-‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</option>`;
    subs.forEach(s=>subSel.innerHTML+=`<option value="${s}">${s}</option>`);
    subSel.style.display="inline-block";
  } else {
    document.getElementById("customCatInput").style.display="none";
    subSel.innerHTML = "";
    subSel.style.display="none";
  }
}
document.getElementById("categoryInput").addEventListener("change", renderSubCatDropdown);
renderCategoryDropdown();

// ==== Admin Panel (DEMO, local array) ====
let users = [
  {id:"admin01", name:"Habibur Rahman", email:"habib@example.com", pass:"123456", role:"admin", status:"active"},
  {id:"mgr03", name:"Shamim Ahmed", email:"shamim@example.com", pass:"shamim@22", role:"manager", status:"active"},
  {id:"user99", name:"Raisa Sultana", email:"raisa@example.com", pass:"raisa@123", role:"user", status:"inactive"},
  {id:"user15", name:"Rifat Islam", email:"rifat@example.com", pass:"rifat@2025", role:"user", status:"active"}
];
let filteredUsers = [...users];
let currentPage = 1, rowsPerPage = 6;
function renderUsers() {
  const tbody = document.getElementById('userTable');
  const noData = document.getElementById('noData');
  tbody.innerHTML = "";
  let total = filteredUsers.length;
  if(total===0) {
    noData.style.display = "block";
    document.getElementById('pagination').innerHTML = "";
    return;
  } else {
    noData.style.display = "none";
  }
  let start = (currentPage-1)*rowsPerPage;
  let end = Math.min(start+rowsPerPage, total);
  for(let idx=start; idx<end; idx++) {
    let u = filteredUsers[idx];
    const passId = 'pass_' + idx;
    tbody.innerHTML += `
      <tr>
        <td>${u.id}</td>
        <td>${u.name}</td>
        <td>${u.email}</td>
        <td>
          <input type="password" value="${u.pass}" readonly id="${passId}" style="width:90px;">
          <button class="showpass-btn" onclick="togglePass('${passId}', this)" title="Show/Hide Password"><i class="fa-solid fa-eye"></i></button>
          <button class="reset-btn" onclick="resetPass(${idx})" title="Reset Password"><i class="fa-solid fa-key"></i></button>
        </td>
        <td>
          <select onchange="changeRole(${idx},this.value)">
            <option value="user" ${u.role==='user'?'selected':''}>User</option>
            <option value="manager" ${u.role==='manager'?'selected':''}>Manager</option>
            <option value="admin" ${u.role==='admin'?'selected':''}>Admin</option>
          </select>
        </td>
        <td>
          <span class="status-badge ${u.status}">${u.status==='active'?'Active':'Inactive'}</span>
          <button class="status-btn" onclick="toggleStatus(${idx})" title="‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶¨‡¶¶‡¶≤‡¶æ‡¶®">
            <i class="fa-solid fa-toggle-${u.status==='active'?'on green':'off grey'}"></i>
          </button>
        </td>
        <td>
          <button class="edit-btn" onclick="editUser(${idx})" title="‡¶è‡¶°‡¶ø‡¶ü"><i class="fa-solid fa-pen"></i></button>
          <button class="delete-btn" onclick="removeUser(${idx})" title="‡¶∞‡¶ø‡¶Æ‡ßÅ‡¶≠"><i class="fa-solid fa-trash"></i></button>
        </td>
      </tr>
    `;
  }
  renderPagination();
}
function renderPagination() {
  let total = filteredUsers.length;
  let pages = Math.ceil(total/rowsPerPage);
  let html = '';
  if(pages<=1) { document.getElementById('pagination').innerHTML=""; return;}
  for(let i=1;i<=pages;i++) {
    html += `<button class="pgn-btn${i===currentPage?' active':''}" onclick="gotoPage(${i})">${i}</button>`;
  }
  document.getElementById('pagination').innerHTML = html;
}
function gotoPage(i) { currentPage=i; renderUsers(); }
function editUser(idx) { alert("Demo!"); }
function removeUser(idx) {
  if(confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
    users.splice(idx,1);
    filteredUsers = [...users];
    showNotif('‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá','success');
    renderUsers();
  }
}
function changeRole(idx, role) {
  users[idx].role = role;
  filteredUsers = [...users];
  showNotif('‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶∞‡ßã‡¶≤ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶π‡ßü‡ßá‡¶õ‡ßá','success');
  renderUsers();
}
function toggleStatus(idx) {
  users[idx].status = users[idx].status==="active"?"inactive":"active";
  filteredUsers = [...users];
  renderUsers();
}
function togglePass(id, btn) {
  const input = document.getElementById(id);
  if(input.type==="password") {
    input.type = "text";
    btn.innerHTML = '<i class="fa-solid fa-eye-slash"></i>';
  } else {
    input.type = "password";
    btn.innerHTML = '<i class="fa-solid fa-eye"></i>';
  }
}
function resetPass(idx) {
  const newPass = prompt('‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® (‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß™ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞):');
  if(newPass && newPass.length>=4) {
    users[idx].pass = newPass;
    filteredUsers = [...users];
    showNotif('‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!','success');
    renderUsers();
  } else if(newPass) {
    showNotif('‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß™ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§','error');
  }
}
function showNotif(txt,type) {
  const bar = document.getElementById('notifBar');
  bar.innerText = txt;
  bar.className = "notif-bar "+type;
  bar.style.display = "block";
  setTimeout(()=>{bar.style.display='none'}, 1700);
}
renderUsers();

// ==== Settings Tab (PWA, 2FA, etc. - ‡¶°‡ßá‡¶Æ‡ßã) ====
document.getElementById("pwaSwitch").onchange = function(){alert("PWA demo: manifest.json/serviceWorker.js required.");};
document.getElementById("2faSwitch").onchange = function(){alert("2FA demo: Firebase Auth 2FA integration required.");};
document.getElementById("notifPref").onchange = function(){alert("‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶π‡ßü‡ßá‡¶õ‡ßá! (‡¶°‡ßá‡¶Æ‡ßã)");};
window.resetData = function(){ alert("Demo! ‡¶°‡ßá‡¶ü‡¶æ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶´‡¶ø‡¶ö‡¶æ‡¶∞"); };
</script>
</body>
</html>